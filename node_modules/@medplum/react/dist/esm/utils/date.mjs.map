{"version":3,"file":"date.mjs","sources":["../../../src/utils/date.ts"],"sourcesContent":["import { Resource } from '@medplum/fhirtypes';\n\n/**\n * Sorts an array of resources in place by meta.lastUpdated ascending.\n * @param resources Array of resources.\n */\nexport function sortByDateAndPriority(resources: Resource[]): void {\n  resources.sort(resourceDateComparator);\n}\n\nfunction resourceDateComparator(a: Resource, b: Resource): number {\n  const priority1 = getPriorityScore(a);\n  const priority2 = getPriorityScore(b);\n  if (priority1 > priority2) {\n    return 1;\n  }\n  if (priority1 < priority2) {\n    return -1;\n  }\n  return getTime(a) - getTime(b);\n}\n\nfunction getPriorityScore(resource: Resource): number {\n  const priority = (resource as any).priority;\n  if (typeof priority === 'string') {\n    return { stat: 4, asap: 3, urgent: 2 }[priority] || 0;\n  }\n  return 0;\n}\n\nfunction getTime(resource: Resource): number {\n  if (resource.resourceType === 'Communication' && resource.sent) {\n    return new Date(resource.sent).getTime();\n  }\n\n  if (\n    (resource.resourceType === 'DiagnosticReport' ||\n      resource.resourceType === 'Media' ||\n      resource.resourceType === 'Observation') &&\n    resource.issued\n  ) {\n    return new Date(resource.issued).getTime();\n  }\n\n  if (resource.resourceType === 'DocumentReference' && resource.date) {\n    return new Date(resource.date).getTime();\n  }\n\n  const dateTime = resource.meta?.lastUpdated;\n  if (!dateTime) {\n    return 0;\n  }\n  return new Date(dateTime).getTime();\n}\n"],"names":[],"mappings":"AAEA;;;AAGG;AACG,SAAU,qBAAqB,CAAC,SAAqB,EAAA;AACzD,IAAA,SAAS,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;AACzC,CAAC;AAED,SAAS,sBAAsB,CAAC,CAAW,EAAE,CAAW,EAAA;AACtD,IAAA,MAAM,SAAS,GAAG,gBAAgB,CAAC,CAAC,CAAC,CAAC;AACtC,IAAA,MAAM,SAAS,GAAG,gBAAgB,CAAC,CAAC,CAAC,CAAC;IACtC,IAAI,SAAS,GAAG,SAAS,EAAE;AACzB,QAAA,OAAO,CAAC,CAAC;AACV,KAAA;IACD,IAAI,SAAS,GAAG,SAAS,EAAE;QACzB,OAAO,CAAC,CAAC,CAAC;AACX,KAAA;IACD,OAAO,OAAO,CAAC,CAAC,CAAC,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;AACjC,CAAC;AAED,SAAS,gBAAgB,CAAC,QAAkB,EAAA;AAC1C,IAAA,MAAM,QAAQ,GAAI,QAAgB,CAAC,QAAQ,CAAC;AAC5C,IAAA,IAAI,OAAO,QAAQ,KAAK,QAAQ,EAAE;AAChC,QAAA,OAAO,EAAE,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,MAAM,EAAE,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;AACvD,KAAA;AACD,IAAA,OAAO,CAAC,CAAC;AACX,CAAC;AAED,SAAS,OAAO,CAAC,QAAkB,EAAA;IACjC,IAAI,QAAQ,CAAC,YAAY,KAAK,eAAe,IAAI,QAAQ,CAAC,IAAI,EAAE;QAC9D,OAAO,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,OAAO,EAAE,CAAC;AAC1C,KAAA;AAED,IAAA,IACE,CAAC,QAAQ,CAAC,YAAY,KAAK,kBAAkB;QAC3C,QAAQ,CAAC,YAAY,KAAK,OAAO;AACjC,QAAA,QAAQ,CAAC,YAAY,KAAK,aAAa;QACzC,QAAQ,CAAC,MAAM,EACf;QACA,OAAO,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,OAAO,EAAE,CAAC;AAC5C,KAAA;IAED,IAAI,QAAQ,CAAC,YAAY,KAAK,mBAAmB,IAAI,QAAQ,CAAC,IAAI,EAAE;QAClE,OAAO,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,OAAO,EAAE,CAAC;AAC1C,KAAA;AAED,IAAA,MAAM,QAAQ,GAAG,QAAQ,CAAC,IAAI,EAAE,WAAW,CAAC;IAC5C,IAAI,CAAC,QAAQ,EAAE;AACb,QAAA,OAAO,CAAC,CAAC;AACV,KAAA;IACD,OAAO,IAAI,IAAI,CAAC,QAAQ,CAAC,CAAC,OAAO,EAAE,CAAC;AACtC;;;;"}