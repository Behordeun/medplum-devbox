{"version":3,"file":"ReferenceInput.mjs","sources":["../../../src/ReferenceInput/ReferenceInput.tsx"],"sourcesContent":["import { Group, NativeSelect, TextInput } from '@mantine/core';\nimport { createReference } from '@medplum/core';\nimport { Reference, Resource, ResourceType } from '@medplum/fhirtypes';\nimport React, { useRef, useState } from 'react';\nimport { ResourceInput } from '../ResourceInput/ResourceInput';\n\nexport interface ReferenceInputProps {\n  name: string;\n  placeholder?: string;\n  defaultValue?: Reference;\n  targetTypes?: string[];\n  onChange?: (value: Reference | undefined) => void;\n}\n\nexport function ReferenceInput(props: ReferenceInputProps): JSX.Element {\n  const targetTypes = getTargetTypes(props.targetTypes);\n  const initialResourceType = getInitialResourceType(props.defaultValue, targetTypes);\n  const [value, setValue] = useState<Reference | undefined>(props.defaultValue);\n  const [resourceType, setResourceType] = useState<string | undefined>(initialResourceType);\n\n  const valueRef = useRef<Reference>();\n  valueRef.current = value;\n\n  const resourceTypeRef = useRef<string>();\n  resourceTypeRef.current = resourceType;\n\n  function setValueHelper(newValue: Reference | undefined): void {\n    setValue(newValue);\n    if (props.onChange) {\n      props.onChange(newValue);\n    }\n  }\n\n  return (\n    <Group spacing=\"xs\" grow noWrap>\n      {targetTypes ? (\n        <NativeSelect\n          data-testid=\"reference-input-resource-type-select\"\n          defaultValue={resourceType}\n          onChange={(e) => setResourceType(e.currentTarget.value)}\n          data={targetTypes}\n        />\n      ) : (\n        <TextInput\n          data-testid=\"reference-input-resource-type-input\"\n          defaultValue={resourceType}\n          onChange={(e) => setResourceType(e.currentTarget.value)}\n        />\n      )}\n      <ResourceInput\n        resourceType={resourceType as ResourceType}\n        name={props.name + '-id'}\n        placeholder={props.placeholder}\n        defaultValue={value}\n        onChange={(item: Resource | undefined) => {\n          setValueHelper(item ? createReference(item) : undefined);\n        }}\n      />\n    </Group>\n  );\n}\n\nfunction getTargetTypes(targetTypes: string[] | undefined): string[] | undefined {\n  if (!targetTypes || targetTypes.length === 0 || (targetTypes.length === 1 && targetTypes[0] === 'Resource')) {\n    return undefined;\n  }\n  return targetTypes;\n}\n\nfunction getInitialResourceType(\n  defaultValue: Reference | undefined,\n  targetTypes: string[] | undefined\n): string | undefined {\n  const defaultValueResourceType = defaultValue?.reference?.split('/')[0];\n  if (defaultValueResourceType) {\n    return defaultValueResourceType;\n  }\n\n  if (targetTypes && targetTypes.length > 0) {\n    return targetTypes[0];\n  }\n\n  return undefined;\n}\n"],"names":[],"mappings":";;;;;AAcM,SAAU,cAAc,CAAC,KAA0B,EAAA;IACvD,MAAM,WAAW,GAAG,cAAc,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC;IACtD,MAAM,mBAAmB,GAAG,sBAAsB,CAAC,KAAK,CAAC,YAAY,EAAE,WAAW,CAAC,CAAC;AACpF,IAAA,MAAM,CAAC,KAAK,EAAE,QAAQ,CAAC,GAAG,QAAQ,CAAwB,KAAK,CAAC,YAAY,CAAC,CAAC;IAC9E,MAAM,CAAC,YAAY,EAAE,eAAe,CAAC,GAAG,QAAQ,CAAqB,mBAAmB,CAAC,CAAC;AAE1F,IAAA,MAAM,QAAQ,GAAG,MAAM,EAAa,CAAC;AACrC,IAAA,QAAQ,CAAC,OAAO,GAAG,KAAK,CAAC;AAEzB,IAAA,MAAM,eAAe,GAAG,MAAM,EAAU,CAAC;AACzC,IAAA,eAAe,CAAC,OAAO,GAAG,YAAY,CAAC;IAEvC,SAAS,cAAc,CAAC,QAA+B,EAAA;QACrD,QAAQ,CAAC,QAAQ,CAAC,CAAC;QACnB,IAAI,KAAK,CAAC,QAAQ,EAAE;AAClB,YAAA,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;AAC1B,SAAA;KACF;IAED,QACE,KAAC,CAAA,aAAA,CAAA,KAAK,EAAC,EAAA,OAAO,EAAC,IAAI,EAAC,IAAI,EAAA,IAAA,EAAC,MAAM,EAAA,IAAA,EAAA;AAC5B,QAAA,WAAW,IACV,KAAC,CAAA,aAAA,CAAA,YAAY,EACC,EAAA,aAAA,EAAA,sCAAsC,EAClD,YAAY,EAAE,YAAY,EAC1B,QAAQ,EAAE,CAAC,CAAC,KAAK,eAAe,CAAC,CAAC,CAAC,aAAa,CAAC,KAAK,CAAC,EACvD,IAAI,EAAE,WAAW,EAAA,CACjB,KAEF,KAAA,CAAA,aAAA,CAAC,SAAS,EAAA,EAAA,aAAA,EACI,qCAAqC,EACjD,YAAY,EAAE,YAAY,EAC1B,QAAQ,EAAE,CAAC,CAAC,KAAK,eAAe,CAAC,CAAC,CAAC,aAAa,CAAC,KAAK,CAAC,GACvD,CACH;AACD,QAAA,KAAA,CAAA,aAAA,CAAC,aAAa,EAAA,EACZ,YAAY,EAAE,YAA4B,EAC1C,IAAI,EAAE,KAAK,CAAC,IAAI,GAAG,KAAK,EACxB,WAAW,EAAE,KAAK,CAAC,WAAW,EAC9B,YAAY,EAAE,KAAK,EACnB,QAAQ,EAAE,CAAC,IAA0B,KAAI;AACvC,gBAAA,cAAc,CAAC,IAAI,GAAG,eAAe,CAAC,IAAI,CAAC,GAAG,SAAS,CAAC,CAAC;aAC1D,EAAA,CACD,CACI,EACR;AACJ,CAAC;AAED,SAAS,cAAc,CAAC,WAAiC,EAAA;IACvD,IAAI,CAAC,WAAW,IAAI,WAAW,CAAC,MAAM,KAAK,CAAC,KAAK,WAAW,CAAC,MAAM,KAAK,CAAC,IAAI,WAAW,CAAC,CAAC,CAAC,KAAK,UAAU,CAAC,EAAE;AAC3G,QAAA,OAAO,SAAS,CAAC;AAClB,KAAA;AACD,IAAA,OAAO,WAAW,CAAC;AACrB,CAAC;AAED,SAAS,sBAAsB,CAC7B,YAAmC,EACnC,WAAiC,EAAA;AAEjC,IAAA,MAAM,wBAAwB,GAAG,YAAY,EAAE,SAAS,EAAE,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;AACxE,IAAA,IAAI,wBAAwB,EAAE;AAC5B,QAAA,OAAO,wBAAwB,CAAC;AACjC,KAAA;AAED,IAAA,IAAI,WAAW,IAAI,WAAW,CAAC,MAAM,GAAG,CAAC,EAAE;AACzC,QAAA,OAAO,WAAW,CAAC,CAAC,CAAC,CAAC;AACvB,KAAA;AAED,IAAA,OAAO,SAAS,CAAC;AACnB;;;;"}