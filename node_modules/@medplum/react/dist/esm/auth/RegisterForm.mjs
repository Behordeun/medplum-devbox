import React, { useState, useEffect } from 'react';
import { Document } from '../Document/Document.mjs';
import { useMedplum } from '../MedplumProvider/MedplumProvider.mjs';
import { NewProjectForm } from './NewProjectForm.mjs';
import { NewUserForm } from './NewUserForm.mjs';

function RegisterForm(props) {
    const { type, projectId, googleClientId, recaptchaSiteKey, onSuccess } = props;
    const medplum = useMedplum();
    const [login, setLogin] = useState(undefined);
    const [outcome, setOutcome] = useState();
    useEffect(() => {
        if (type === 'patient' && login) {
            medplum
                .startNewPatient({ login, projectId: projectId })
                .then((response) => medplum.processCode(response.code))
                .then(() => onSuccess())
                .catch((err) => setOutcome(err));
        }
    }, [medplum, type, projectId, login, onSuccess]);
    function handleAuthResponse(response) {
        if (response.code) {
            medplum
                .processCode(response.code)
                .then(() => onSuccess())
                .catch(console.log);
        }
        else if (response.login) {
            setLogin(response.login);
        }
    }
    return (React.createElement(Document, { width: 450 },
        outcome && React.createElement("pre", null, JSON.stringify(outcome, null, 2)),
        !login && (React.createElement(NewUserForm, { projectId: projectId, googleClientId: googleClientId, recaptchaSiteKey: recaptchaSiteKey, handleAuthResponse: handleAuthResponse }, props.children)),
        login && type === 'project' && React.createElement(NewProjectForm, { login: login, handleAuthResponse: handleAuthResponse })));
}

export { RegisterForm };
//# sourceMappingURL=RegisterForm.mjs.map
